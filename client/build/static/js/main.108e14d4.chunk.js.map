{"version":3,"sources":["TextEditor.js","App.js","reportWebVitals.js","index.js"],"names":["TOOLBAR_OPTIONS","header","font","list","color","background","script","align","TextEditor","documentId","useParams","id","useState","socket","setSocket","quill","setQuil","console","log","useEffect","s","io","disconnect","once","document","setContents","enable","emit","interval","setInterval","getContents","clearInterval","handler","delta","updateContents","on","off","oldDelta","source","wrapperRef","useCallback","wrapper","innerHTML","editor","createElement","append","q","Quill","theme","modules","toolbar","disable","setText","className","ref","App","path","exact","to","uuidV4","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"iOASMA,EAAkB,CACtB,CAAC,CAAEC,OAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,GAAG,KAC9B,CAAC,CAAEC,KAAM,KACT,CAAC,CAAEC,KAAM,WAAa,CAAEA,KAAM,WAC9B,CAAC,OAAQ,SAAU,aACnB,CAAC,CAAEC,MAAO,IAAM,CAAEC,WAAY,KAC9B,CAAC,CAAEC,OAAQ,OAAS,CAAEA,OAAQ,UAC9B,CAAC,CAAEC,MAAO,KACV,CAAC,QAAS,aAAc,cACxB,CAAC,UAGY,SAASC,IAAc,IACxBC,EAAeC,cAAnBC,GAD2B,EAEPC,qBAFO,mBAE5BC,EAF4B,KAEpBC,EAFoB,OAGVF,qBAHU,mBAG5BG,EAH4B,KAGrBC,EAHqB,KAInCC,QAAQC,IAAIT,GAIZU,qBAAU,WACR,IAAMC,EAAIC,cAGV,OAFAP,EAAUM,GAEH,WACLA,EAAEE,gBAEH,IAEHH,qBAAU,WACM,MAAVN,GAA2B,MAATE,IAEtBF,EAAOU,KAAK,iBAAiB,SAAAC,GAC3BT,EAAMU,YAAYD,GAClBT,EAAMW,YAGRb,EAAOc,KAAK,eAAelB,MAC1B,CAACI,EAAQE,EAAON,IAEnBU,qBAAU,WACR,GAAc,MAAVN,GAA2B,MAATE,EAAtB,CAEA,IAAMa,EAAWC,aAAY,WAC3BhB,EAAOc,KAAK,gBAAgBZ,EAAMe,iBA7Cf,KAgDrB,OAAO,WACLC,cAAcH,OAEhB,CAACf,EAAOE,IAEVI,qBAAU,WACR,GAAc,MAAVN,GAA2B,MAATE,EAAtB,CACA,IAAMiB,EAAW,SAAAC,GACflB,EAAMmB,eAAeD,IAIvB,OAFApB,EAAOsB,GAAG,kBAAkBH,GAErB,WACLnB,EAAOuB,IAAI,kBAAkBJ,OAE9B,CAACnB,EAAOE,IAEXI,qBAAU,WACR,GAAc,MAAVN,GAA2B,MAATE,EAAtB,CAOA,OAFAA,EAAMoB,GAAG,eAJO,SAACF,EAAOI,EAAUC,GAClB,SAAXA,GACHzB,EAAOc,KAAK,eAAgBM,MAIvB,WACLlB,EAAMqB,IAAI,mBAEX,CAACvB,EAAOE,IAEX,IAAMwB,EAAaC,uBAAY,SAACC,GAC9B,GAAe,MAAXA,EAAJ,CACAA,EAAQC,UAAY,GACpB,IAAMC,EAASnB,SAASoB,cAAc,OACtCH,EAAQI,OAAOF,GACf,IAAMG,EAAI,IAAIC,IAAMJ,EAAQ,CAC1BK,MAAO,OACPC,QAAS,CAAEC,QAASlD,KAEtB8C,EAAEK,UACFL,EAAEM,QAAQ,cACVpC,EAAQ8B,MAGP,IAGH,OACE,qBAAKO,UAAU,YAAYC,IAAKf,I,oBChFrBgB,MAff,WACE,OACE,cAAC,IAAD,UACE,eAAC,IAAD,WACE,cAAC,IAAD,CAAOC,KAAK,IAAIC,OAAK,EAArB,SACE,cAAC,IAAD,CAAUC,GAAE,qBAAgBC,oBAE9B,cAAC,IAAD,CAAOH,KAAK,iBAAZ,SACE,cAAChD,EAAD,YCLKoD,EAZS,SAAAC,GAClBA,GAAeA,aAAuBC,UACxC,6BAAqBC,MAAK,YAAkD,IAA/CC,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAON,GACPO,EAAQP,OCAdQ,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,EAAD,MAEF/C,SAASgD,eAAe,SAM1BZ,M","file":"static/js/main.108e14d4.chunk.js","sourcesContent":["import React from 'react'\nimport { useCallback, useEffect, useState } from 'react'\nimport Quill from 'quill'\nimport \"quill/dist/quill.snow.css\"\nimport { io } from 'socket.io-client'\nimport { useParams } from 'react-router-dom'\n\n\nconst SAVE_INTERVAL_MS = 2000\nconst TOOLBAR_OPTIONS = [\n  [{ header: [1, 2, 3, 4, 5, 6, false] }],\n  [{ font: [] }],\n  [{ list: \"ordered\" }, { list: \"bullet\" }],\n  [\"bold\", \"italic\", \"underline\"],\n  [{ color: [] }, { background: [] }],\n  [{ script: \"sub\" }, { script: \"super\" }],\n  [{ align: [] }],\n  [\"image\", \"blockquote\", \"code-block\"],\n  [\"clean\"],\n]\n\nexport default function TextEditor() {\n  const { id: documentId } = useParams()\n  const [socket, setSocket] = useState()\n  const [quill, setQuil] = useState()\n  console.log(documentId)\n\n  \n\n  useEffect(() => {\n    const s = io()\n    setSocket(s)\n\n    return () => {\n      s.disconnect()\n    }\n  }, [])\n\n  useEffect(()=>{\n    if (socket == null || quill == null) return\n\n    socket.once(\"load-document\", document => {\n      quill.setContents(document)\n      quill.enable()\n    })\n\n    socket.emit('get-document',documentId)\n  }, [socket, quill, documentId])\n\n  useEffect(()=>{\n    if (socket == null || quill == null) return\n    \n    const interval = setInterval(()=>{\n      socket.emit('save-document',quill.getContents())\n    },SAVE_INTERVAL_MS)\n\n    return () =>{\n      clearInterval(interval)\n    }\n  },[socket,quill])\n\n  useEffect(()=>{\n    if (socket == null || quill == null) return\n    const handler =  delta => {\n      quill.updateContents(delta)\n    }\n    socket.on('receive-changes',handler)\n\n    return () => {\n      socket.off('receive-changes',handler)\n    }\n  }, [socket,quill])\n\n  useEffect(()=>{\n    if (socket == null || quill == null) return\n    const handler = (delta, oldDelta, source)=>{\n      if(source !== 'user') return\n      socket.emit(\"send-changes\", delta)\n    }\n    quill.on('text-change',handler)\n\n    return () => {\n      quill.off('text-change',)\n    }\n  }, [socket,quill])\n\n  const wrapperRef = useCallback((wrapper) => {\n    if (wrapper == null) return\n    wrapper.innerHTML = ''\n    const editor = document.createElement('div')\n    wrapper.append(editor)\n    const q = new Quill(editor, {\n      theme: \"snow\",\n      modules: { toolbar: TOOLBAR_OPTIONS }\n    })\n    q.disable()\n    q.setText('Loading...')\n    setQuil(q)          //肉粽頭\n    //asdfasdf\n    //asdfasdf\n  }, [])\n\n\n  return (\n    <div className=\"container\" ref={wrapperRef}></div>\n  )\n}","import TextEditor from './TextEditor'\nimport {\n  BrowserRouter as Router,\n  Switch,\n  Route,\n  Redirect\n} from 'react-router-dom'\nimport { v4 as uuidV4 } from 'uuid'\n\nfunction App() {\n  return(\n    <Router>\n      <Switch>\n        <Route path=\"/\" exact>\n          <Redirect to={`/documents/${uuidV4()}`} />\n        </Route>\n        <Route path=\"/documents/:id\">\n          <TextEditor />\n        </Route>\n      </Switch>\n    </Router>\n  )\n}\n\nexport default App;","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './styles.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}